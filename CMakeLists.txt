#CMakeLists for /

# Name of the project
PROJECT(kvirc)

# Minimum cmake version
CMAKE_MINIMUM_REQUIRED(VERSION 2.4.6)

# Set conventional loops
SET(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS true)

# Some vars
SET(KVI_PACKAGE "kvirc")
SET(KVI_MAJOR "4")
SET(KVI_VERSION "4.0.0")
SET(KVI_VERSION_BRANCH "4.0")

SET(LIBS)

# Install path
IF(UNIX)
	IF(APPLE)
	# MacOS X
		SET(KVI_INSTALL_PREFIX .)
	ELSE()
	# Linux
		SET(KVI_INSTALL_PREFIX /usr/local)
	ENDIF()
ELSEIF(WIN32)
	SET(KVI_INSTALL_PREFIX .)
ENDIF()

# Skel from cmake.org
#FIND_PACKAGE(PNG)
#IF(PNG_FOUND)
#	INCLUDE_DIRECTORIES(${PNG_INCLUDE_DIR})
#	
#	ADD_EXECUTABLE(imageviewer main.c image.c)
#	TARGET_LINK_LIBRARIES(imageviewer ${PNG_LIBRARY})
#ENDIF(PNG_FOUND)

# Check for Qt4
FIND_PACKAGE(Qt4 REQUIRED)
IF(QT4_FOUND)
	SET(QT_USE_QT3SUPPORT true)
	IF(APPLE)
		SET(QT_USE_QTSQL true)
		SET(QT_USE_QTXML true)
		SET(QT_USE_QTNETWORK true)
	ENDIF()
	ADD_DEFINITIONS(-DCOMPILE_USE_QT4)
	INCLUDE(${QT_USE_FILE})
	INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR} ${QT_INCLUDES})
	#SET(LIBS ${LIBS} ${QT_LIBRARIES})
	LIST(APPEND LIBS ${QT_LIBRARIES})
ENDIF()

# Check for Perl
FIND_PACKAGE(Perl REQUIRED)

# Check for OpenSSL
FIND_PACKAGE(OpenSSL)
IF(OPENSSL_FOUND)
	INCLUDE_DIRECTORIES(${OPENSSL_INCLUDE_DIR})
	#SET(LIBS ${LIBS} ${OPENSSL_LIBRARIES})
	LIST(APPEND LIBS ${OPENSSL_LIBRARIES})
	IF(APPLE)
		LIST(APPEND LIBS -lcrypto)
	ENDIF()
	ADD_DEFINITIONS(-DCOMPILE_CRYPT_SUPPORT)
ENDIF()

# Check for ZLib
FIND_PACKAGE(ZLIB REQUIRED)
IF(ZLIB_FOUND)
	INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIR})
	#SET(LIBS ${LIBS} ${ZLIB_LIBRARIES})
	LIST(APPEND LIBS ${ZLIB_LIBRARIES})
ENDIF()

# Check for X11
IF(UNIX)
	IF(APPLE)
	ELSE()
	# Linux
	FIND_PACKAGE(X11)
		IF(X11_FOUND)
        		INCLUDE_DIRECTORIES(${X11_INCLUDE_DIR})
			#SET(LIBS ${LIBS} ${X11_LIBRARIES})
			LIST(APPEND LIBS ${X11_LIBRARIES})
		ENDIF()
	ENDIF()
ENDIF()

# Check for threads
FIND_PACKAGE(Threads REQUIRED)
#IF(Threads_FOUND)
IF(CMAKE_HAVE_THREADS_LIBRARY)
	#SET(LIBS ${LIBS} ${CMAKE_THREAD_LIBS_INIT})
	LIST(APPEND LIBS ${CMAKE_THREAD_LIBS_INIT})
ENDIF()

#Unused by now
#CMakeUnixFindMake.cmake
#FindDoxygen.cmake
#FindCygwin.cmake
#CMakeFindXCode.cmake
#CheckLibraryExists.cmake

# Search for subdirectories
SUBDIRS(src data)
